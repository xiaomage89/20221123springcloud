var page=require("webpage").create(),system=require("system");var m=Math.floor(Math.random()*1000000);var address=system.args[1].split("'")[1];var imgDir=system.args[3];var widgetids_arr=system.args[4].split(",");page.viewportSize={width:1200,height:580};page.onAlert=function(a){console.log(a);phantom.exit();};page.onCallback=function(a){console.log(a);phantom.exit();};page.open(address,function(a){if(a!=="success"){console.log("Unable to load the address: "+address+"， 状态码： "+a);phantom.exit(1);}else{window.setTimeout(function(){var b=page.evaluate(function(){try{return g_rptpage.cmd_widgetsPosition(true);}catch(f){alert(f);}});console.log(b);if(widgetids_arr.length>0){for(var c=0;c<widgetids_arr.length;c++){var d=widgetids_arr[c];if(!d){continue;}screenshot(d);page.evaluate(function(h){try{var f=window.document.getElementById(h);if(!!f){f.style.position=window.g_rptpage.tempPosition;f.style.zIndex=window.g_rptpage.tempZIndex;f.style.backgroundColor=window.g_rptpage.tempColor;}}catch(g){alert(g);}},d);}}phantom.exit();},10000);}});function screenshot(b){var a=page.evaluate(window["getBounds"],b);if(!a||a.length<4){return;}page.clipRect={top:parseInt(a[0]),left:parseInt(a[1]),width:parseInt(a[2]),height:parseInt(a[3])};page.render(imgDir+b+"_"+m+++".png");}function getBounds(d){try{if(!window.disablePanel){var j=window["widgetFloat_jsons"];if(j){var a=g_rptpage.getWidgets();for(var g=0;g<j.length;g++){var o=j[g];if(!o||!o.id){continue;}var l=o.id;if(a[l]){a[l].setContentVisible(false);a[l].icon.style.display="none";}}}window.disablePanel=true;}var p=new Array();var b=window.document.getElementById(d);if(!!b){var k=1;var f=1;var c=b.scrollWidth;var n=b.scrollHeight;p[0]=k;p[1]=f;p[2]=c;p[3]=n;window.g_rptpage.tempPosition=b.style.position;window.g_rptpage.tempZIndex=b.style.zIndex;window.g_rptpage.tempColor=b.style.backgroundColor;b.style.position="fixed";b.style.backgroundColor="#ffffff";b.style.zIndex=999;b.style.top=k+"px";b.style.left=f+"px";b.style.width=c+"px";b.style.height=n+"px";}return p;}catch(h){alert(h);}}